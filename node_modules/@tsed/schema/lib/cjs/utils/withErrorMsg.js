"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.withErrorMsg = void 0;
const core_1 = require("@tsed/core");
const jsonEntityFn_js_1 = require("../decorators/common/jsonEntityFn.js");
function withErrorMsg(errorKey, originalDecorator) {
    const schema = {};
    return ((...decoratorOptions) => {
        const decorator = (0, core_1.useDecorators)(originalDecorator(...decoratorOptions));
        decorator.Error = (message) => {
            schema.message = message;
            return (0, core_1.useDecorators)(decorator, schema.message &&
                (0, jsonEntityFn_js_1.JsonEntityFn)((store) => {
                    // since errorMessage is a custom key, it is prefixed with a # to avoid conflict with JSON Schema keywords
                    const errorMessage = store.parentSchema.get("#errorMessage") || {};
                    if (errorKey === "required") {
                        store.parentSchema.customKey("errorMessage", (0, core_1.deepMerge)(errorMessage, {
                            [errorKey]: {
                                [store.propertyName]: message
                            }
                        }));
                    }
                    else {
                        store.itemSchema.customKey("errorMessage", (0, core_1.deepMerge)(errorMessage, {
                            [errorKey]: message
                        }));
                    }
                }));
        };
        return decorator;
    });
}
exports.withErrorMsg = withErrorMsg;
//# sourceMappingURL=withErrorMsg.js.map