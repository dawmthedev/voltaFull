"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.generateSpec = void 0;
const core_1 = require("@tsed/core");
const SpecTypes_js_1 = require("../domain/SpecTypes.js");
const getSpec_js_1 = require("./getSpec.js");
const getSpecType_js_1 = require("./getSpecType.js");
const mapOpenSpec_js_1 = require("./mapOpenSpec.js");
const mergeSpec_js_1 = require("./mergeSpec.js");
const transformToOS2_js_1 = require("./transformToOS2.js");
/**
 * Generate OpenAPI spec from multiple sources (models, files, conf)
 * @param tokens
 * @param options
 */
function generateSpec({ tokens, ...options }) {
    const { version = "1.0.0", acceptMimes, fileSpec = {}, specVersion } = options;
    const defaultSpec = (0, mapOpenSpec_js_1.mapOpenSpec)((0, core_1.getValue)(options, "spec", {}), {
        fileSpec,
        version,
        specVersion,
        acceptMimes
    });
    const specType = (0, getSpecType_js_1.getSpecTypeFromSpec)(defaultSpec);
    let controllersSpec = (0, getSpec_js_1.getSpec)(tokens, options);
    const spec = (0, mergeSpec_js_1.mergeSpec)(defaultSpec, controllersSpec);
    if (options.sortPaths) {
        spec.paths = Object.fromEntries(Object.entries(spec.paths).sort(([k1], [k2]) => {
            return k1.localeCompare(k2);
        }));
    }
    if (specType === SpecTypes_js_1.SpecTypes.SWAGGER) {
        return (0, transformToOS2_js_1.transformToOS2)(spec);
    }
    return spec;
}
exports.generateSpec = generateSpec;
//# sourceMappingURL=generateSpec.js.map