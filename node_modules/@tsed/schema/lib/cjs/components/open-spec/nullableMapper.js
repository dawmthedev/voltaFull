"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.nullableMapperOpenApi = void 0;
const core_1 = require("@tsed/core");
const SpecTypes_js_1 = require("../../domain/SpecTypes.js");
const JsonSchemaMapperContainer_js_1 = require("../../registries/JsonSchemaMapperContainer.js");
function nullableMapperOpenApi(obj, schema) {
    if (!schema?.isNullable) {
        return obj;
    }
    if (obj.$ref) {
        return (0, core_1.cleanObject)({
            ...obj,
            ...(obj.$ref && {
                anyOf: [
                    {
                        $ref: obj.$ref
                    }
                ],
                type: undefined
            }),
            nullable: true,
            $ref: undefined
        });
    }
    return (0, core_1.cleanObject)({
        ...obj,
        ...(obj.anyOf?.length === 1
            ? {
                ...obj.anyOf[0],
                anyOf: undefined,
                type: Number.isInteger(obj.multipleOf) ? "integer" : obj.anyOf[0]?.type
            }
            : {
                type: obj.anyOf?.length > 1 ? undefined : obj.type,
                anyOf: obj.anyOf?.map((item) => {
                    if (Number.isInteger(item.multipleOf)) {
                        item.type = "integer";
                    }
                    return item;
                })
            }),
        nullable: true
    });
}
exports.nullableMapperOpenApi = nullableMapperOpenApi;
(0, JsonSchemaMapperContainer_js_1.registerJsonSchemaMapper)("nullable", nullableMapperOpenApi, SpecTypes_js_1.SpecTypes.OPENAPI);
(0, JsonSchemaMapperContainer_js_1.registerJsonSchemaMapper)("nullable", nullableMapperOpenApi, SpecTypes_js_1.SpecTypes.SWAGGER);
//# sourceMappingURL=nullableMapper.js.map